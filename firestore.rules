rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Allow logged-in users to create and update their own user document.
    match /users/{userId} {
      allow read, create, update: if request.auth.uid == userId;
    }

    // Allow anyone to create shortened URLs.
    // Allow anyone to read/redirect from shortened URLs.
    match /shortenedUrls/{alias} {
      allow read, create;
    }

    // Rules for bug reports
    match /bugReports/{reportId} {
      // Allow logged-in users to create reports.
      allow create: if request.auth != null;
      
      // Allow the user who created the report to read it.
      // Allow any authenticated user (assumed admin for now) to read all reports.
      allow read: if request.auth != null;
      
      // Only allow admins to update the report (e.g., status, reply).
      // This rule is simplified and assumes admin logic is handled elsewhere.
      // For production, you would check for an admin claim: request.auth.token.admin == true
      allow update: if request.auth != null; 
    }
    
    // Rules for user-specific progress data
    match /userProgress/{userId} {
      // Users can read and write their own progress document.
      allow read, write: if request.auth.uid == userId;
    }
    
    // Rules for global announcements, make them readable by anyone
    match /global_announcements/{announcementId} {
      allow read: if true;
    }
  }
}
